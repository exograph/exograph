stages:
    # create Blobs
    - operation: |
        mutation ($sample_blob: String!) {
            createImages(data: [
                { name: "foo", data: $sample_blob },
                { name: "bar", data: $sample_blob },
                { name: "baz", data: $sample_blob },
            ]) {
                id @bind(name: "image_uuids")
                name
            }
        }
      variable: |
        {
            // blank GIF
            "sample_blob": "R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="
        }
      response: |
        {
            "data": {
                "createImages": (actual) => {
                    let uuid_v4_regex = new RegExp("^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$");

                    for (const element of actual) {
                        if (!uuid_v4_regex.test(element.id)) {
                            throw new ClaytipError(id + " is not a valid UUID")
                        }
                    }
                    return true; 
                }
            }
        }
    
    # retrieve using UUIDs
    - operation: |
        query($foo_id: Int!, $bar_id: Int!, $baz_id: Int!) {
            foo: images(where: { id: { eq: $foo_id } }) {
                name
            }

            bar: images(where: { id: { eq: $bar_id } }) {
                name
            }

            baz: images(where: { id: { eq: $baz_id } }) {
                name
            }
        }
      variable: |
        {
            "foo_id": $.image_uuids[0],
            "bar_id": $.image_uuids[1],
            "baz_id": $.image_uuids[2]
        }
      response: |
        {
          "data": {
            "foo": [
              {
                "name": "foo"
              }
            ],
            "bar": [
              {
                "name": "bar"
              }
            ],
            "baz": [
              {
                "name": "baz"
              }
            ]
          }
        }