context AuthContext {
  id: Int @jwt("sub")
  role: String @jwt("role")
}

@postgres
service ConcertService {
  @table("concerts")
  @access(query=AuthContext.role == "ROLE_ADMIN" || self.published, mutation=AuthContext.role == "ROLE_ADMIN")
  type Concert {
    id: Int = autoincrement() @pk
    title: String
    venue: Venue @column("venueid")
    published: Boolean
    price: Decimal @precision(20) @scale(2)
  }
  
  @table("venues")
  @access(query=AuthContext.role == "ROLE_ADMIN" || self.published, mutation=AuthContext.role == "ROLE_ADMIN")
  type Venue {
    id: Int = autoincrement() @pk
    name: String
    concerts: Set<Concert>? @column("venueid")
    published: Boolean
    latitude: Float @size(4)
  }
}